<%doc>
</%doc>
<%args>
	$submit		=> '';
	$network	=> '';
</%args>

<%perl>
	if ($submit eq "Commit Changes") {
		foreach my $nparg (keys %ARGS) {
			my $var;
			if ($nparg =~ /^snort:(.+)$/) {
				$var        = $1;
			} else {
				next;
			}

			if ($var eq 'mode') {
				$np->cfg->snort(-key => 'mode', -network => $network, -val => $ARGS{$nparg})
					if ($ARGS{$nparg} =~ /^(enabled|disabled|not_really)$/);
			} elsif ($var =~ /^rorw_(.+)$/) {
				my $v = $1;
				$np->cfg->snort(-key => $v, -sval => 'servers', -network => $network, -val => $ARGS{$nparg})
					 if ($ARGS{$nparg} =~ /^(ro|rw)$/ && !exists $ARGS{"snort:delete_$v"});
			} elsif ($var eq 'addnewsensor' && defined $ARGS{'snort:addnewsensor'}) {
				if ($ARGS{'snort:newport'} =~ /^\d+$/ &&
				    $ARGS{'snort:newrorw'} =~ /^(ro|rw)$/ &&
				    $ARGS{'snort:newsensor'} =~ /^\w*\.*\w*\.*\w+\.\w+$/) {
					my $v = $ARGS{'snort:newsensor'}.':'.$ARGS{'snort:newport'};
					$np->cfg->snort(-key => $v, -sval => 'servers', -network => $network,
						        -val => $ARGS{'snort:newrorw'});
				}
			} elsif ($var =~ /^delete_(.+)$/ && defined $ARGS{$nparg} ) {
				my $v = $1;
				$np->cfg->snort(-key => $v, -sval => 'servers', -network => $network, -del => 1);
			}
		}
	}

</%perl>

<TABLE WIDTH=800 class="expandable" ID="snortConfig" CELLSPACING=2 CELLPADDING=2>
<THEAD>
<TR><TH onclick="showHideObj2(getElementById('snortConfig').tBodies[0]);" COLSPAN=2>Snort</TH></TR>
</THEAD>
<TBODY>
<TR><TD CLASS='left'>mode</TD>
<TD CLASS='right'>
<%$q->popup_menu (
                        -name     => 'snort:mode',
                        -values   => ['enabled', 'disabled', 'not_really'],
                        -default  => $np->cfg->snort(-key => 'mode', -network => $network)
                    )%>
</TD></TR>
<TR><TD CLASS='left'>Snort Sensors</TD>
<TD CLASS='right' ALIGN=center>
<TABLE WIDTH=80% BGCOLOR="#ffffff" CELLSPACING=2 CELLPADDING=2>
<TR>
<TD CLASS="gray" ALIGN=center>Sensor</TD>
<TD CLASS="gray" ALIGN=center>Port</TD>
<TD CLASS="gray" ALIGN=center>Mode</TD>
<TD CLASS="gray" ALIGN=center>Action</TD>
</TR>

<%perl>
	my $h = $np->cfg->snort(-key => 'servers', -network => $network);
	foreach my $s (keys %$h) {
		my($server, $port) = split(/:/, $s);
		print "<TR>";
		print "<TD CLASS=\"gray\" ALIGN=center>$server</TD>";
		print "<TD CLASS=\"gray\" ALIGN=center>$port</TD>";
		print "<TD CLASS=\"gray\" ALIGN=center>";
		print $q->popup_menu (
					-name	  => "snort:rorw_$s",
					-values	  => ['ro', 'rw'],
					-default  => $np->cfg->snort(-key => $s, -sval => 'servers', -network => $network)
				     );
		print "</TD>";
		print "<TD CLASS=\"gray\" ALIGN=left>";
		print $q->checkbox (
					-name	=> "snort:delete_$s",
					-label	=> " Delete",
				   );
		print "</TD></TR>";
	}
	print "<TR>";
	print "<TD CLASS=\"gray\" ALIGN=center>";
	print $q->textfield (
				-name	=> "snort:newsensor",
				-size	=> 40,
			    );
	print "</TD><TD CLASS=\"gray\" ALIGN=center>";
        print $q->textfield (
                                -name   => "snort:newport",
                                -size   => 5,
                            );
	print "</TD><TD CLASS=\"gray\" ALIGN=center>";
	print $q->popup_menu (
				-name     => "snort:newrorw",
				-values   => ['ro', 'rw'],
				-default  => 'ro',
			     );
	print "</TD><TD CLASS=\"gray\" ALIGN=left>";
	print $q->checkbox (
				-name   => "snort:addnewsensor",
				-label  => " Add",
			   );
	print "</TD>";
	print "</TR>";
</%perl>

</TABLE>
</TD></TR>
</TBODY>
</TABLE>
<BR>
