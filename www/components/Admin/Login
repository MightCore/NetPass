<%doc>
# $Header: /tmp/netpass/NetPass/www/components/Admin/Login,v 1.5 2005/04/06 20:50:38 jeffmurphy Exp $

#   (c) 2004 University at Buffalo.
#   Available under the "Artistic License"
#   http://www.gnu.org/licenses/license-list.html#ArtisticLicense

This component outputs a login prompt form.
</%doc>


<%args>
        $username  => undef
        $password  => undef
	$wherefrom => undef
</%args>

<%perl>
        return 1 if (exists $m->session->{'logged_in'} && 
			($m->session->{'logged_in'} == 1));

        if (defined($username) && ($username ne "")) {
	    	my $aok = $np->authenticateAdmin($username,
        		                        $password);

		if (defined($aok) && ($aok == 1)) {
			$m->session->{'logged_in'} = 1; # FIX/Client/Login
			$m->session->{'username'}  = $username;
			$m->session->{'my_groups'} = $npdbh->getUserGroups($username);
			if ($m->caller(-1)->path =~ /^\/Admin/) {
				$m->redirect($m->caller(-1)->path);
			} else {
				$m->redirect('/Admin');
			}

                	return 1;
                } else {
                        print "<center>Authentication failed.</center><P>";
                }
        } 

</%perl>

<form method="post" name="mainForm">
 <table align=center border='0' width='300'>
   <tr><th align=center colspan=2>Login</th></tr>
   <tr><td><%$np->policy('USERNAME_PROMPT') || "Username:"%></td>
       <td><input name="username" size=8></td>
   </tr>
   <tr><td><%$np->policy('PASSWORD_PROMPT') || "Password:"%></td>
       <td><input type=password name="password" size=8></td>
   </tr>
   <tr><td colspan=2 align=center><input type="submit" value="Login"></td></tr>
 </table>
<input type=hidden name=JavaScript value=''>
</form>

<script language="JavaScript"><!--
document.mainForm.JavaScript.value = 'enabled';
//--></script>

<%perl>
        return 0;
</%perl>
