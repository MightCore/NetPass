
<%doc>
# $Header: /tmp/netpass/NetPass/www/htdocs/Admin/gencfg.mhtml,v 1.14 2005/05/06 03:09:33 jeffmurphy Exp $

#   (c) 2004 University at Buffalo.
#   Available under the "Artistic License"
#   http://www.gnu.org/licenses/license-list.html#ArtisticLicense

NAME

	General Configuration 

PERMISSIONS

	RO: NONE
	RW: Must be member of default/Admin

</%doc>

<%args>
	$submit => '';
</%args>

<script><!--
setWhereAmI('General Config');
--></script>

<%perl>

my ($isRoot, $groups) = $m->comp('/Admin/MemberOf', 'group' => 'default', 'acl' => [ 'Admin' ]);

if (! $isRoot  ) {
        print $q->p({-class=>'error'}, qq{Sorry, permission denied.<BR>(You must be an Admin for group "default".)});
        return;
}

my $restartnetpass = 0;
my $restartnessus  = 0;
my $restarthttpd   = 0;

if ($submit eq 'Commit Changes') {
	foreach my $ak ( keys %ARGS ) {
		if ($ak =~ /^(\S+):(\S+)$/) {
			my $section = $1;
			my $var     = $2;

			if ($section eq "policy") {
				if ($var =~ /^PID_DIR|BASE_DIR$/) {
					$restartnetpass = 1;
					$restarthttpd = 1;
				}
				$np->cfg->policy(-key => $var, -val => $ARGS{$ak});
			}

			elsif ($section eq "nessus") {
				$np->cfg->policy(-key => $var, -val => $ARGS{$ak});
				$restartnessus = 1;
			}

			elsif ($section eq "database") {
				$np->cfg->policy(-key => $var, -val => $ARGS{$ak});
				$restartnetpass = 1;
			}
		}
	}

	$np->db->reqAppAction('nessusd', 'restart', '') if ($restartnessus);
	$np->db->reqAppAction('netpass', 'restart', '') if ($restartnetpass);
	$np->db->reqAppAction('httpd',   'restart', '') if ($restarthttpd);

	$np->cfg->save(-user => $m->session->{'username'});
}

print $q->start_form(-method => "POST");

</%perl>

<h2>General (Global) Configuration</h2>

<input disabled id='submitButton' type='submit' name='submit' value='Commit Changes'> <P>

% $m->comp('/Admin/LockConfig', 'enableWhenLocked' => 'submitButton');


<TABLE WIDTH=800 ID="policyConfig" class="expandable" CELLSPACING=2 CELLPADDING=2>
<THEAD>
<TR><TH onclick="showHideObj2(getElementById('policyConfig').tBodies[0]);" COLSPAN=2>General (Global)</TH></TR>
</THEAD>
<TBODY>
<TR>
<TD CLASS='left'>MULTI_MAC</TD>
<TD CLASS='right' >

<%$q->popup_menu (
                        -name     => 'policy:MULTI_MAC',
                        -values   => ['ALL_OK', 'ONE_OK', 'DISALLOWED'],
                        -default  => $np->cfg->policy(-key => 'MULTI_MAC'),
                    )%>
<!--<a href="help.mhtml?printable=1&topic=MULTI_MAC" target='new' style='align:right;'>?</a>-->
</TD></TR>
<TR>
<TD CLASS='left'>Strikes</TD>
<TD CLASS='right'>
<%$q->textfield (
                        -name   => 'policy:STRIKES',
                        -value  => $np->cfg->policy(-key => 'STRIKES'),
                        -size   => 3,
                    )%>
</TD></TR>

<TR>
<TD CLASS='left'>Disable Strikes For Manual Quarantine</TD>
<TD CLASS='right'>
<%$q->radio_group (
                        -name   => 'policy:NO_STRIKES_FOR_MANUAL',
			-values => [ 'Yes', 'No' ],
                        -default  => $np->cfg->policy(-key => 'NO_STRIKES_FOR_MANUAL' ) ? "Yes" : "No",
                        -size   => 3,
                    )%>
</TD>
</TR>

<TR>
<TD CLASS='left'>Disable Strikes For Snort Quarantine</TD>
<TD CLASS='right'>
<%$q->radio_group (
                        -name   => 'policy:NO_STRIKES_FOR_SNORT',
			-values => [ 'Yes', 'No' ],
                        -default  => $np->cfg->policy(-key => 'NO_STRIKES_FOR_SNORT' ) ? "Yes" : "No",
                        -size   => 3,
                    )%>
</TD>
</TR>

<TR>
<TD CLASS='left'>Disable Strikes For Nessus Quarantine</TD>
<TD CLASS='right'>
<%$q->radio_group (
                        -name   => 'policy:NO_STRIKES_FOR_NESSUS',
			-values => [ 'Yes', 'No' ],
                        -default  => $np->cfg->policy(-key => 'NO_STRIKES_FOR_NESSUS' ) ? "Yes" : "No",
                        -size   => 3,
                    )%>
</TD>
</TR>

<TR>
<TD CLASS='left'>RESULTS_DISPLAY</TD>
<TD CLASS='right'>
<%$q->popup_menu (
                        -name     => 'policy:RESULTS_DISPLAY',
			-values	  => ['INLINE', 'POPUP'],
                        -default  => $np->cfg->policy(-key => 'RESULTS_DISPLAY'),
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>RESULTS_EXPAND</TD>
<TD CLASS='right'>
<%$q->textfield (
                        -name   => 'policy:RESULTS_EXPAND',
                        -value  => $np->cfg->policy(-key => 'RESULTS_EXPAND'),
                        -size   => 3,
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>AUTO_REDIRECT</TD>
<TD CLASS='right'>
<%$q->radio_group (
                        -name    => 'policy:AUTO_REDIRECT',
			-values  => ['Yes', 'No'],
                        -default => ($np->cfg->policy(-key => 'AUTO_REDIRECT')) ? 'Yes' : 'No',
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>COOKIE_DETECT</TD>
<TD CLASS='right'>
<%$q->radio_group (
                        -name    => 'policy:COOKIE_DETECT',
                        -values  => ['Yes', 'No'],
                        -default => ($np->cfg->policy(-key => 'COOKIE_DETECT')) ? 'Yes' : 'No',
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>COOKIE_NAME</TD>
<TD CLASS='right'>
<%$q->textfield (
                        -name   => 'policy:COOKIE_NAME',
                        -value  => $np->cfg->policy(-key => 'COOKIE_NAME'),
                        -size   => 25,
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>REDIR_URL_DEFAULT</TD>
<TD CLASS='right'>
<%$q->textfield (
                        -name   => 'policy:REDIR_URL_DEFAULT',
                        -value  => $np->cfg->policy(-key => 'REDIR_URL_DEFAULT'),
                        -size   => 25,
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>SURVEY_ENABLED</TD>
<TD CLASS='right'>
<%$q->radio_group (
                        -name    => 'policy:SURVEY_ENABLED',
                        -values  => ['Yes', 'No'],
                        -default => ($np->cfg->policy(-key => 'SURVEY_ENABLED')) ? 'Yes' : 'No',
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>SURVEY_EMAIL</TD>
<TD CLASS='right'>
<%$q->textfield (
                        -name   => 'policy:SURVEY_EMAIL',
                        -value  => $np->cfg->policy(-key => 'SURVEY_EMAIL'),
                        -size   => 25,
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>PID_DIR</TD>
<TD CLASS='right'>
<%$q->textfield (
                        -name   => 'policy:PID_DIR',
                        -value  => $np->cfg->policy(-key => 'PID_DIR'),
                        -size   => 25,
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>BASE_DIR</TD>
<TD CLASS='right'>
<%$q->textfield (
                        -name   => 'policy:BASE_DIR',
                        -value  => $np->cfg->policy(-key => 'BASE_DIR'),
                        -size   => 25,
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>PORT_SEARCH_ALGO</TD>
<TD CLASS='right'>
<%$q->popup_menu (
                        -name     => 'policy:PORT_SEARCH_ALGO',
                        -values   => ['LINEAR', 'TREE'],
                        -default  => $np->cfg->policy(-key => 'PORT_SEARCH_ALGO'),
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>PORT_CACHE</TD>
<TD CLASS='right'>
<%$q->popup_menu (
                        -name     => 'policy:PORT_CACHE',
                        -values   => ['ON', 'OFF'],
                        -default  => ($np->cfg->policy(-key => 'PORT_CACHE')) ? 'ON' : 'OFF',
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>UNQUAR_ON_LINKUP</TD>
<TD CLASS='right'>
<%$q->popup_menu (
                        -name     => 'policy:UNQUAR_ON_LINKUP',
                        -values   => ['ON', 'OFF', 'ITDEPENDS'],
                        -default  => ($np->cfg->policy(-key => 'UNQUAR_ON_LINKUP') eq
				     'ITDEPENDS') ? 'ITDEPENDS' : 
				     ($np->cfg->policy(-key => 'UNQUAR_ON_LINKUP')) ? 
				     'ON' : 'OFF',
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>Enable ResetPort?</TD>
<TD CLASS='right'>
<%$q->popup_menu (
                        -name     => 'policy:resetport',
                        -values   => ['on', 'off'],
                        -default  => ($np->cfg->policy(-key => 'resetport')) ? 'on': 'off',
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>Enable MacScan?</TD>
<TD CLASS='right'>
<%$q->popup_menu (
                        -name     => 'policy:macscan',
                        -values   => ['on', 'off'],
                        -default  => ($np->cfg->policy(-key => 'macscan')) ? 'on': 'off',
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>Require Nessus to register?</TD>
<TD CLASS='right'>
<%$q->popup_menu (
                        -name     => 'policy:nessus',
                        -values   => ['on', 'off'],
                        -default  => ($np->cfg->policy(-key => 'resetport')) ? 'on': 'off',
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>LDAP Query URL</TD>
<TD CLASS='right'>
<%$q->textfield (
                        -name   => 'policy:LDAP_USER_QUERY',
                        -value  => $np->cfg->policy(-key => 'LDAP_USER_QUERY'),
                        -size   => 25,
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>LDAP Popup Width</TD>
<TD CLASS='right'>
<%$q->textfield (
                        -name   => 'policy:LDAP_POPUP_WIDTH',
                        -value  => $np->cfg->policy(-key => 'LDAP_POPUP_WIDTH'),
                        -size   => 5,
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>LDAP Popup Height</TD>
<TD CLASS='right'>
<%$q->textfield (
                        -name   => 'policy:LDAP_POPUP_HEIGHT',
                        -value  => $np->cfg->policy(-key => 'LDAP_POPUP_HEIGHT'),
                        -size   => 5,
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>Username Prompt</TD>
<TD CLASS='right'>
<%$q->textfield (
                        -name   => 'policy:USERNAME_PROMPT',
                        -value  => $np->cfg->policy(-key => 'USERNAME_PROMPT'),
                        -size   => 25,
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>Password Prompt</TD>
<TD CLASS='right'>
<%$q->textfield (
                        -name   => 'policy:PASSWORD_PROMPT',
                        -value  => $np->cfg->policy(-key => 'PASSWORD_PROMPT'),
                        -size   => 25,
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>Company Name</TD>
<TD CLASS='right'>
<%$q->textfield (
                        -name   => 'policy:COMPANY_NAME',
                        -value  => $np->cfg->policy(-key => 'COMPANY_NAME'),
                        -size   => 25,
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>Company Abbreviation</TD>
<TD CLASS='right'>
<%$q->textfield (
                        -name   => 'policy:COMPANY_SHORT_NAME',
                        -value  => $np->cfg->policy(-key => 'COMPANY_SHORT_NAME'),
                        -size   => 25,
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>Organization Name</TD>
<TD CLASS='right'>
<%$q->textfield (
                        -name   => 'policy:COMPANY_UNIT_NAME',
                        -value  => $np->cfg->policy(-key => 'COMPANY_UNIT_NAME'),
                        -size   => 25,
                    )%>
</TD></TR>
<TR>
<TD CLASS='left'>Example IP Address</TD>
<TD CLASS='right'>
<%$q->textfield (
                        -name   => 'policy:EXAMPLE_IPADDR',
                        -value  => $np->cfg->policy(-key => 'EXAMPLE_IPADDR'),
                        -size   => 16,
                    )%>
</TD></TR>

</TBODY></TABLE>
<BR>


<TABLE WIDTH=800 class="expandable" ID="nessusConfig" CELLSPACING=2 CELLPADDING=2>
<THEAD>
<TR><TH onclick="showHideObj2(getElementById('nessusConfig').tBodies[0]);" COLSPAN=2>Nessus</TH></TR>
</THEAD>
<TBODY>
<TR><TD CLASS='left'>Base_Dir</TD><TD CLASS='right'><input type="text" name="nessus:base_dir" value="<%$np->cfg->nessus(-key => 'BASE_DIR')%>" size="25" /></TD></TR>
<TR><TD CLASS='left'>Host</TD><TD CLASS='right'><input type="text" name="nessus:host" value="<%$np->cfg->nessus(-key => 'host')%>" size="25" /></TD></TR>
<TR><TD CLASS='left'>Username</TD><TD CLASS='right'><input type="text" name="nessus:username" value="<%$np->cfg->nessus(-key => 'username')%>" size="25" /></TD></TR>
<TR><TD CLASS='left'>Password</TD><TD CLASS='right'><input type="text" name="nessus:password" value="<%$np->cfg->nessus(-key => 'password')%>" size="25" /></TD></TR>
<TR><TD CLASS='left'>Port</TD><TD CLASS='right'><input type="text" name="nessus:port" value="<%$np->cfg->nessus(-key => 'port')%>" size="25" /></TD></TR>
<TR><TD CLASS='left'>When_down</TD><TD CLASS='right'><%$q->radio_group(-name => 'nessus:WHEN_DOWN', -default=>$np->cfg->nessus(-key => 'WHEN_DOWN'), -values => ['OK','FAIL'])%></TD></TR>
</TBODY>
</TABLE>
<BR>

<TABLE WIDTH=800 CLASS="expandable" ID="databaseConfig" CELLSPACING=2 CELLPADDING=2>
<THEAD>
<TR><TH ONCLICK="showHideObj2(getElementById('databaseConfig').tBodies[0]);" COLSPAN=2>Database</TH></TR>
</THEAD>
<TBODY>
<%perl>


foreach my $d (sort $np->cfg->{'cfg'}->keys('database')) {
        print "<TR>";
        print "<TD CLASS='left'>$d</TD>";
        print "<TD CLASS='right'>";
        print $q->textfield (
                                -name   => "database:$d",
				-value  => $np->cfg->{'cfg'}->obj('database')->value($d),
				-size 	=> 25 ,
                            );
        print "</TD></TR>";
}
print "</TBODY></TABLE>";

print $q->end_form();
</%perl>

<script language="JavaScript">
/* showHideObj2(document.getElementById("databaseConfig").tBodies[0]);
 showHideObj2(document.getElementById("nessusConfig").tBodies[0]);
 showHideObj2(document.getElementById("policyConfig").tBodies[0]);*/
</script>
